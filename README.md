<h1>Data Manipulation within Splunk</h1>

<h2>Description</h2>
Data processing, parsing, and manipulation are important for getting meaningful insights from machine-generated data. Having the right skills is very useful when responding to security threats, investigating incidents, and monitoring system health. In this lab, I will be covering how events are parsed in Splunk, the importance of conf files, how to extract custom fields, and how to identify timestamps within an event log.
<br />
<br />
In this scenario, we are working as a SOC analyst who needs to ingest some logs for a client. Splunk needs to be configured to parse and transform the logs, we have the following issues: Event breaking, multi-line events, Masking, and extracting custom fields. We will be addressing these issues within the terminal on our VM.
<br />


<h2>Languages and Utilities Used</h2>

- <b>Splunk</b> 
- <b>SPL</b>
- <b>linux CLI</b>
- <b>Splunk stanzas</b>

<h2>Environments Used </h2>

- <b>Linux Virtual Machine</b>

<h2>Configuration Files and their Purpuse</h2>

- <b>Inputs.conf - Defines data inputs and how to collect data from sources.</b> 
- <b>Props.conf - Specifies parsing rules for different sourcetypes to extract fields and define field extractions.</b>
- <b>Transforms.conf - Allows you to define field transformations and enrichments on indexed policies, and access control.</b>
- <b>Indexes.conf - Manages the configuration of indexes in Splunk, including storage, retention policies, and access control.</b>
- <b>Outpus.conf - Specifies the destination and settings for sending data  to various outputs, such as remote Splunk instances or third-party systems.</b>
- <b>Authentication.conf - Manages authentication settings and user authentication methods.</b>

<h2>Lab Walk-through</h2>

<p align="center">
1. Now that we understand the different types of conf files, let's spin up Splunk. First lets navigate to the directory where Splunk is located and run the following command to spin up the instance with root privileges. After that runs you should be able to access Splunk via the web browser: <br/>
<img src="https://imgur.com/TCtCH8x.png" height="80%" width="80%" alt="Splunk Searching Steps"/>
<br />
<br />
2. Once you are in the web interface, we are going to create a simple app. Splunk apps are pre-packaged software modules or extensions that enhance the functionality of Splunk. On the home page you can see the available apps by clicking the settings gear icon to the right of where it says “Apps”:  <br/>
<img src="https://imgur.com/umJILdL.png" height="80%" width="80%" alt="Splunk Searching Steps"/>
<br />
<br />
3. To create an app, we can select create an app in the top right corner: <br/>
<img src="https://imgur.com/nDEni3W.png" height="80%" width="80%" alt="Splunk Searching Steps"/>
<br />
<br />
4. Then we just fill out the details of the app we are creating:  <br/>
<img src="https://imgur.com/6EXeDx2.png" height="80%" width="80%" alt="Splunk Searching Steps"/>
 <br />
<br />
5. We can see that our app has been created and can check to see if any logs have been generated by clicking “launch app”:  <br/>
<img src="https://imgur.com/46NLEdH.png" height="80%" width="80%" alt="Splunk Searching Steps"/><br />
<br />
6. There is no activity yet, so we need to generate logs. :  <br/>
<img src="https://imgur.com/rPbzOFK.png" height="80%" width="80%" alt="Splunk Searching Steps"/><br />
<br />
7. To look at our App directory we can navigate to opt/splunk/etc/apps. Here we can see our DataApp and other Splunk apps available to us:  <br/>
<img src="https://imgur.com/Lyn7iWZ.png" height="80%" width="80%" alt="Splunk Searching Steps"/><br />
<br />
8. We can also see what A Splunk app directory contains by looking into the DataApps directory. The key directories/files include app.conf, bin, default,and local:  <br/>
<img src="https://imgur.com/23ma72V.png" height="80%" width="80%" alt="Splunk Searching Steps"/>
 <br />
<br />
9. The bin directory holds custom scripts and binaries required by the app. Let’s head to the bin directory and add a Python script. Create a script using nano and save it. Note of the full path to this script for later:  <br/>
<img src="https://imgur.com/6RFKnyk.png" height="80%" width="80%" alt="Splunk Searching Steps"/>
 <br />
<br />
10. In our default directory let’s add and configure inputs.conf file using nano:  <br/>
<img src="https://imgur.com/4iIHmnn.png" height="80%" width="80%" alt="Splunk Searching Steps"/>
 <br />
<br />
11. After configuring our inputs.conf file, let's restart our Splunk instance using the following command:  <br/>
<img src="https://imgur.com/0MfCcLo.png" height="80%" width="80%" alt="Splunk Searching Steps"/>
 <br />
<br />
12. Now if we go back to the Splunk interface and check out our app we can see the script is pulling into our app!:  <br/>
<img src="https://imgur.com/CUYPRj0.png" height="80%" width="80%" alt="Splunk Searching Steps"/>
 <br />
<br />
13. Next, we are going to configure vpn logs to generate some events. Copy the VPNlogs script from the download’s directory to the bin directory on the DataApp we created earlier. Write the following into the inputs.conf and then restart Splunk:  <br/>
<img src="https://imgur.com/PKeYy8h.png" height="80%" width="80%" alt="Splunk Searching Steps"/>
 <br />
<br />
14. Loading up our Splunk instance and searching for our new logs we can see that the VPN logs are pulling in with an issue. Splunk is unable to determine the boundaries of each event and considers multiple events as one. To fix this we can edit the props.conf file and use regex to determine the end of each event:  <br/>
<img src="https://imgur.com/7EaIqin.png" height="80%" width="80%" alt="Splunk Searching Steps"/>
 <br />
<br />
15. Let’s create a Props.conf file by using nano and adding the following lines and then restart Splunk to put those changes into effect:  <br/>
<img src="https://imgur.com/x6XLeJW.png" height="80%" width="80%" alt="Splunk Searching Steps"/>
 <br />
<br />
16. A quick search will now show us that our logs are pulling in correctly and the props.conf file is working perfectly:  <br/>
<img src="https://imgur.com/0XGpt3m.png" height="80%" width="80%" alt="Splunk Searching Steps"/>
 <br />
<br />
17. Next, we are going to parse events that contain multiple lines. Start by copying over the Authentication_logs from our downloads folder and adding these lines to the inputs.conf file:  <br/>
<img src="https://imgur.com/bleO1i7.png" height="80%" width="80%" alt="Splunk Searching Steps"/>
 <br />
<br />
18. Restart Splunk and look at our logs. Now our logs have another issue, the events are being separated and Splunk doesn’t know where exactly to break the event. Let’s edit our props.conf file to have the following code to fix the breaking issue:  <br/>
<img src="https://imgur.com/cEkPpGw.png" height="80%" width="80%" alt="Splunk Searching Steps"/>
 <br />
<br />
19. When we reloaded our search, we can see that our props.conf file has helped fix our breaking issue. Now each event includes both lines:  <br/>
<img src="https://imgur.com/2MhuhgF.png" height="80%" width="80%" alt="Splunk Searching Steps"/>
 <br />
<br />
20. Masking sensitive data like credit card numbers, and other PII is important when trying to adhere to standards like PCI DSS and HIPAA. Splunk provides features such as field masking and anonymization to protect sensitive information. Let’s copy over our purchase-details file from our downloads and add the following lines to our input.conf::  <br/>
<img src="https://imgur.com/kp0pRhW.png" height="80%" width="80%" alt="Splunk Searching Steps"/>
 <br />
<br />
21. After we restart Splunk we see that our events are not breaking properly again. We can fix this by using regex in the Props.conf file like this: “MUST_BREAK_AFTER = \d{4}\.”. When you restart Splunk your logs should look like this:  <br/>
<img src="https://imgur.com/kxa59v6.png" height="80%" width="80%" alt="Splunk Searching Steps"/>
 <br />
<br />
22. Now that we have fixed the breaking issue we can shift to masking the credit card numbers. The SEDCMD uses regex to replace a matching pattern oldvalue and replace it with the newvalue. After the configuration of our props.conf file will look like this:  <br/>
<img src="https://imgur.com/qXbwVk2.png" height="80%" width="80%" alt="Splunk Searching Steps"/>
 <br />
<br />
23. Restart Splunk and you should see the credit card information has been properly masked.:  <br/>
<img src="https://imgur.com/LBV5QCH.png" height="80%" width="80%" alt="Splunk Searching Steps"/>
 <br />
<br />
24. Now let us go back to the vpnlogs to extract some custom fields. When looking at the logs none of the fields are being extracted properly. We can use regex to help us here. Let us start by creating a transforms.conf file and configure it like this:  <br/>
<img src="https://imgur.com/LBV5QCH.png" height="80%" width="80%" alt="Splunk Searching Steps"/>
 <br />
<br />
25. Next, we need to update our props to mention the transforms.conf changes we made:  <br/>
<img src="https://imgur.com/LBV5QCH.png" height="80%" width="80%" alt="Splunk Searching Steps"/>
 <br />
<br />
26. The next step is to create a fields.conf file to mention the field we are going to extract from the logs:  <br/>
<img src="https://imgur.com/LBV5QCH.png" height="80%" width="80%" alt="Splunk Searching Steps"/>
 <br />
<br />
27. Restart Splunk to see that the field has been properly extracted:  <br/>
<img src="https://imgur.com/LBV5QCH.png" height="80%" width="80%" alt="Splunk Searching Steps"/>
 <br />
<br />
28. Lets update the Transforms.conf to extract all three fields:  <br/>
<img src="https://imgur.com/LBV5QCH.png" height="80%" width="80%" alt="Splunk Searching Steps"/>
 <br />
<br />
29. Update the fields.conf as well:  <br/>
<img src="https://imgur.com/LBV5QCH.png" height="80%" width="80%" alt="Splunk Searching Steps"/>
 <br />
<br />
30. After restarting Splunk we can see that we have successfully extracted the custom fields!  <br/>
<img src="https://imgur.com/LBV5QCH.png" height="80%" width="80%" alt="Splunk Searching Steps"/>
</p>

<!--
 ```diff
- text in red
+ text in green
! text in orange
# text in gray
@@ text in purple (and bold)@@
```
--!>
